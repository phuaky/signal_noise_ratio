<!DOCTYPE html>
<html>
<head>
    <title>Test Twitter Page</title>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .tweet {
            border: 1px solid #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            max-width: 600px;
            margin: 20px auto;
        }
        button {
            background: #1d9bf0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            margin: 10px;
            cursor: pointer;
        }
        #controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #111;
            padding: 15px;
            border-radius: 10px;
        }
        #log {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: #111;
            padding: 15px;
            border-radius: 10px;
            max-width: 400px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="controls">
        <h3>Test Controls</h3>
        <button onclick="addTweet('tech')">Add Tech Tweet</button>
        <button onclick="addTweet('lifestyle')">Add Lifestyle Tweet</button>
        <button onclick="addTweet('empty')">Add Empty Tweet</button>
        <button onclick="addTweet('retweet')">Add Retweet</button>
        <button onclick="addMultipleTweets()">Add 5 Tweets</button>
        <button onclick="clearTweets()">Clear All</button>
    </div>

    <div id="log">
        <h4>Detection Log</h4>
        <div id="logContent"></div>
    </div>

    <div id="timeline">
        <h2 style="text-align: center;">Test Tweet Timeline</h2>
    </div>

    <script>
        let tweetCount = 0;
        const log = (msg) => {
            const logEl = document.getElementById('logContent');
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        };

        const techTweets = [
            "Just shipped our new AI feature using GPT-4 and Next.js! üöÄ",
            "Raised $10M in Series A funding for our startup",
            "Check out my new open source project on GitHub: github.com/example/repo",
            "Implementing microservices architecture with Kubernetes",
            "Machine learning model achieved 95% accuracy!"
        ];

        const lifestyleTweets = [
            "Just had the best coffee at Starbucks ‚òï",
            "My morning skincare routine is everything",
            "Can't wait for the weekend! Time to relax",
            "New recipe alert! Making pasta tonight üçù",
            "Fashion week was amazing! So many great outfits"
        ];

        function createTweetElement(type = 'tech') {
            tweetCount++;
            const tweet = document.createElement('article');
            tweet.setAttribute('data-testid', 'tweet');
            tweet.className = 'tweet';
            
            let content = '';
            
            if (type === 'tech') {
                content = techTweets[Math.floor(Math.random() * techTweets.length)];
            } else if (type === 'lifestyle') {
                content = lifestyleTweets[Math.floor(Math.random() * lifestyleTweets.length)];
            } else if (type === 'empty') {
                content = '';
            } else if (type === 'retweet') {
                content = 'RT: ' + techTweets[Math.floor(Math.random() * techTweets.length)];
            }
            
            tweet.innerHTML = `
                <div>
                    <div data-testid="User-Name">
                        <span>Test User ${tweetCount}</span>
                        <span tabindex="-1"><span>@testuser${tweetCount}</span></span>
                    </div>
                    <div data-testid="tweetText">${content}</div>
                    <div>
                        <div data-testid="reply" aria-label="5 replies">üí¨ 5</div>
                        <div data-testid="retweet" aria-label="10 retweets">üîÅ 10</div>
                        <div data-testid="like" aria-label="50 likes">‚ù§Ô∏è 50</div>
                    </div>
                </div>
            `;
            
            return tweet;
        }

        function addTweet(type = 'tech') {
            const timeline = document.getElementById('timeline');
            const tweet = createTweetElement(type);
            timeline.appendChild(tweet);
            log(`Added ${type} tweet #${tweetCount}`);
        }

        function addMultipleTweets() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const types = ['tech', 'lifestyle', 'tech', 'lifestyle', 'retweet'];
                    addTweet(types[i]);
                }, i * 100);
            }
        }

        function clearTweets() {
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '<h2 style="text-align: center;">Test Tweet Timeline</h2>';
            tweetCount = 0;
            log('Cleared all tweets');
        }

        // Add initial tweets
        setTimeout(() => {
            log('Adding initial tweets...');
            addTweet('tech');
            addTweet('lifestyle');
            addTweet('tech');
        }, 1000);

        // Monitor for extension activity
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.nodeType === 1 && node.className && node.className.includes('sn-')) {
                        log(`Extension added element: ${node.className}`);
                    }
                });
            });
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });

        // Log extension detection
        setInterval(() => {
            const badges = document.querySelectorAll('.sn-indicator');
            const analyzedCount = badges.length;
            const totalTweets = document.querySelectorAll('[data-testid="tweet"]').length;
            
            if (totalTweets > 0) {
                const status = `Tweets: ${totalTweets}, Analyzed: ${analyzedCount}`;
                document.title = status;
            }
        }, 1000);
    </script>
</body>
</html>